#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
النظام الطبي الذكي المتكامل - الخادم الخلفي
Medical AI System Backend

تطوير: عمر أحمد فتحي & أحمد هاني النجار
"""

from flask import Flask, request, jsonify, render_template
from flask_cors import CORS
import json
import datetime
import random
import re
from typing import Dict, List, Tuple

app = Flask(__name__)
CORS(app)

class MedicalAISystem:
    """نظام الذكاء الاصطناعي الطبي المتكامل"""

    def __init__(self):
        self.medical_knowledge = {
            'symptoms': {
                'حمى': {
                    'conditions': [
                        {'name': 'عدوى فيروسية', 'treatment': 'راحة، سوائل، خافض حرارة مثل الباراسيتامول', 'prevention': 'غسل اليدين، تجنب المصابين'},
                        {'name': 'عدوى بكتيرية', 'treatment': 'مضاد حيوي يحدده الطبيب', 'prevention': 'النظافة والتطعيم'},
                        {'name': 'الإنفلونزا', 'treatment': 'راحة، سوائل، أدوية أعراض', 'prevention': 'لقاح الإنفلونزا السنوي'},
                        {'name': 'التهاب الحلق', 'treatment': 'غرغرة، مضاد حيوي إن كان بكتيري', 'prevention': 'تجنب مشاركة الأغراض الشخصية'}
                    ],
                    'severity': 'عالي',
                    'specialties': ['الطب الباطني', 'طب الأطفال']
                },
                'سكري': {
                    'conditions': [
                        {'name': 'السكري من النوع الأول', 'treatment': 'حقن الأنسولين اليومية', 'prevention': 'غير قابل للوقاية حالياً'},
                        {'name': 'السكري من النوع الثاني', 'treatment': 'حمية، تمارين، أدوية خافضة للسكر', 'prevention': 'نمط حياة صحي وتغذية متوازنة'}
                    ],
                    'severity': 'عالي',
                    'specialties': ['الغدد الصماء', 'الطب الباطني']
                },
                'سعال': {
                    'conditions': [
                        {'name': 'نزلة برد', 'treatment': 'راحة، وسوائل دافئة، خافض حرارة', 'prevention': 'تجنب التعرض للبرد والعدوى'},
                        {'name': 'التهاب الشعب الهوائية', 'treatment': 'مضادات حيوية أو موسعات شعبية', 'prevention': 'الإقلاع عن التدخين، تجنب الملوثات'},
                        {'name': 'الربو', 'treatment': 'بخاخات موسعة للشعب ومضادات التهابات', 'prevention': 'تجنب المحفزات مثل الغبار والدخان'},
                        {'name': 'الحساسية', 'treatment': 'مضادات هيستامين، تجنب المهيجات', 'prevention': 'استخدام فلتر هواء، تجنب مسببات الحساسية'}
                    ],
                    'severity': 'متوسط',
                    'specialties': ['الطب الباطني', 'أمراض الصدر']
                },
                'صداع': {
                    'conditions': [
                        {'name': 'الصداع النصفي', 'treatment': 'مسكنات خاصة مثل التريبتانات، راحة في مكان مظلم', 'prevention': 'تجنب المحفزات مثل الجفاف والنوم القليل'},
                        {'name': 'صداع التوتر', 'treatment': 'مسكنات، تمارين استرخاء', 'prevention': 'تقليل التوتر والقلق'},
                        {'name': 'ارتفاع ضغط الدم', 'treatment': 'أدوية خافضة للضغط', 'prevention': 'نظام غذائي منخفض الصوديوم ومتابعة طبية'},
                        {'name': 'التهاب الجيوب الأنفية', 'treatment': 'مضادات حيوية ومزيلات احتقان', 'prevention': 'علاج التحسس مبكراً وتجنب الملوثات'}
                    ],
                    'severity': 'متوسط',
                    'specialties': ['الأعصاب', 'الطب الباطني']
                },
                'آلام الحلق': {
                    'conditions': [
                        {'name': 'التهاب اللوزتين', 'treatment': 'مضاد حيوي إن كان السبب بكتيري، مسكنات', 'prevention': 'تجنب العدوى من الآخرين'},
                        {'name': 'التهاب البلعوم الفيروسي', 'treatment': 'راحة، سوائل، مسكنات', 'prevention': 'تجنب الأشخاص المصابين'}
                    ],
                    'severity': 'متوسط',
                    'specialties': ['الأنف والأذن والحنجرة']
                },
                'إمساك': {
                    'conditions': [
                        {'name': 'متلازمة القولون العصبي', 'treatment': 'نظام غذائي غني بالألياف، مضادات تقلصات', 'prevention': 'شرب الماء بانتظام، تقليل التوتر'},
                        {'name': 'نقص النشاط البدني', 'treatment': 'ممارسة الرياضة وتغيير نمط الحياة', 'prevention': 'الحفاظ على نمط حياة نشط'}
                    ],
                    'severity': 'منخفض',
                    'specialties': ['أمراض الجهاز الهضمي']
                },
                'طفح جلدي': {
                    'conditions': [
                        {'name': 'الأكزيما', 'treatment': 'مرطبات وكريمات كورتيزون', 'prevention': 'تجنب المواد المثيرة للتحسس، ترطيب الجلد'},
                        {'name': 'العدوى الفطرية', 'treatment': 'كريمات مضادة للفطريات', 'prevention': 'تجفيف الجلد جيداً وعدم مشاركة المناشف'}
                    ],
                    'severity': 'منخفض',
                    'specialties': ['الجلدية']
                }
            },
            'specialties': {
                'internal': 'الطب الباطني',
                'cardiology': 'أمراض القلب',
                'neurology': 'الأعصاب',
                'orthopedics': 'العظام',
                'dermatology': 'الجلدية',
                'pediatrics': 'طب الأطفال',
                'gynecology': 'النساء والتوليد',
                'psychiatry': 'الطب النفسي',
                'pulmonology': 'أمراض الصدر',
                'gastroenterology': 'أمراض الجهاز الهضمي',
                'endocrinology': 'الغدد الصماء',
                'rheumatology': 'الروماتيزم',
                'ent': 'الأنف والأذن والحنجرة'
            },
            'animal_diseases': {
                'الكلاب': {
                    'داء الكلب': {
                        'symptoms': ['سلوك عدواني', 'رغوة من الفم', 'رهاب الماء'],
                        'treatment': 'لا يوجد علاج فعال بعد ظهور الأعراض. الوقاية عبر التطعيم.',
                        'prevention': 'تطعيم الكلب بانتظام، تجنب اختلاطه بحيوانات برية'
                    },
                    'البراغيث': {
                        'symptoms': ['حكة مستمرة', 'قروح جلدية', 'سلوك عصبي'],
                        'treatment': 'استخدام شامبو مضاد للبراغيث أو دواء بيطري',
                        'prevention': 'تنظيف مكان نوم الحيوان، استخدام طارد للحشرات'
                    }
                },
                'القطط': {
                    'التسمم': {
                        'symptoms': ['قيء', 'خمول', 'ارتعاش'],
                        'treatment': 'مضادات سموم تحت إشراف بيطري',
                        'prevention': 'تجنب وصول القطط إلى الأدوية أو النباتات السامة'
                    },
                    'فطريات الأذن': {
                        'symptoms': ['هرش الأذن', 'خروج إفرازات', 'رائحة كريهة'],
                        'treatment': 'قطرات مضادة للفطريات',
                        'prevention': 'تنظيف الأذن دورياً وعدم تعرضها للرطوبة'
                    }
                }
            },
            'emergency_keywords': [
                'ألم شديد في الصدر', 'صعوبة في التنفس', 'فقدان الوعي', 
                'نزيف شديد', 'ألم شديد في البطن', 'حمى عالية'
            ]
        }

        self.conversation_history = {}

    # باقي الكود يمكن استكماله كما في النموذج السابق مع دعم العلاج والوقاية في النتائج

# هنا يمكننا إكمال تكامل هذه البيانات في الردود التحليلية
# وإن أردت، أتابع بدمجها في دوال /analyze و /chat و /history

if __name__ == '__main__':
    print("\U0001F3E5 بدء تشغيل النظام الطبي الذكي المتكامل...")
    print("\U0001F468‍\U0001F4BB تطوير: عمر أحمد فتحي & أحمد هاني النجار")
    print("\U0001F310 الخادم يعمل على: http://localhost:5000")
    app.run(debug=True, host='0.0.0.0', port=5000)
